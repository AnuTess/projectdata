<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
</head>

<div id="map"></div>
<script>
var width = 960,
    height = 500;

var projection = d3.geo.albersUsa();

var path = d3.geo.path().projection(projection);
	
var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var states;

var digitScale = d3.scale.category10()
var percentScale = d3.scale.linear().domain([0, 10, 15]).range(["#fee0d2", "#fc9272", "#de2d26"]);

var stateAtlas;

d3.json("us.json", function(error, shapes) {
	states = topojson.feature(shapes, shapes.objects.states).features;

	var statePaths = svg.append("g");
	statePaths.selectAll("path").data(states).enter()
	.append("path").attr("d", path)
	.style("fill", function (state) { return digitScale(state.Percent); })
	.style("stroke", "#ccc");
	
		d3.csv("Graph1Data.csv", function (error, rows) {
		if (error) {console.log(error);}
		
		// what should we do with the CSV data?
		stateAtlas = d3.map(rows, function (state) { 
			return Number(state.Id); 
		});
		
		statePaths.selectAll("path")
		.style("fill", function (state) {
			var stateData = stateAtlas.get(state.id);
			console.log("stateData for "+state.id +" is "+stateData);
			if (! stateData) {return "none";}
			for (var x=0; x<49; x++){
				console.log("id " + stateData.Id+", name " +stateData.State+", percent "+stateData.Percent);
			}
			return percentScale(stateData.Percent);
		});
		
	});
		
	});
	

</script>
</html>
