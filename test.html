<html>
<!-- Now look at health care workers -->

<head>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

<!-- Move to different file! -->
<style>
	.scxAxis path, .scyAxis path {
		fill: none;
		stroke: black;
	}
	.scxAxis, .scyAxis text {
		font-size: 8px;
		font-family: "Open Sans";
	}
	body {
		font-family: "Open Sans";
	}

	.topstate{
	  	stroke: red;
	}


    .grid {
    	stroke: #d3d3d3;
    	opacity: 0.7;
	}	

	.grid path {
		stroke-width: 0;
	}


</style>


</head>

<body>
<h1>Mental Health in the US</h1>

<h3>Distribution of Mental Health Cases in the US</h3>
<div id="map"></div>
<defs>
	<linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#fff;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#de2d26;stop-opacity:1" />
    </linearGradient>
</defs>

<h3>Mental Health Cases Correlated to Relative Income and Veteran Population</h3>
<div id="scatter"></div>


<div id="scatter2"></div>
<h3>Mental Health Cases Correlated to Density of Mental Health Workers</h3>

<p>Mental Health Counselors, Child Family and School Social Workers, Healthcare Social Workers, Mental Health and Substance Abuse Social Workers, Social Workers All Other, Psychiatrists, Clinical Counseling and School Psychologists, and Psychologists (All Other)</p>


<script>


/************ Scatter Plot 2 ************/ 
		// Defining Dimensions
	var scMargin2 = {top: 20, right: 20, bottom: 30, left: 40}
	var scatterWidth2 = 850 - scMargin2.left - scMargin2.right
	var scatterHeight2 = 400 - scMargin2.top - scMargin2.bottom

	// Defining Scales
	var scatterxVal2 = function(d) { return d.Percent; },
		scatterxScale2 = d3.scale.linear().range([0, scatterWidth2]),
		scatterxMap2 = function(d) { return scatterxScale2(scatterxVal2(d)); },
		scatterxAxis2 = d3.svg.axis().scale(scatterxScale2).orient("bottom");

	var scatteryVal2 = function(d) { 
		console.log(d.Doctor_Density);
		return d.Doctor_Density; },
		scatteryScale2 = d3.scale.linear().range([scatterHeight2,0]),
		scatteryMap2 = function(d) { return scatteryScale2(scatteryVal2(d)); },
		scatteryAxis2 = d3.svg.axis()
						.scale(scatteryScale2).orient("left");

	// Creating svg
	var scattersvg2 = d3.select("body").append("svg")
		.attr("width", scatterWidth2	+ scMargin2.left + scMargin2.right )
		.attr("height", scatterHeight2 + scMargin2.top + scMargin2.bottom )
		.append ("g")
			.attr("transform", "translate(" + scMargin2.left + "," + scMargin2.top + ")");

	var gscatter2 = scattersvg2.append("g")
		.attr("transform", "translate(100,0) scale(.8)");

	// Formatting Data
	d3.csv("scatterplot2.csv", function (error, rows) {
		if (error) {console.log(error);}
		rows.forEach(function(d) {
			d.Percent = +d.Percent;
			d.Doctor_Density = +d.Doctor_Density;
		});

		// Formating Scales
		scatterxScale2.domain([d3.min(rows, scatterxVal2), d3.max(rows, scatterxVal2)]);
		scatteryScale2.domain([d3.min(rows, scatteryVal2), d3.max(rows, scatteryVal2)]);

		// Creating x,y axis
		 gscatter2.append("g") 
		 	.attr("class", "scxAxis")
		 	.attr("transform", "translate(0," + scatterHeight2 + ")")
		 	.call(scatterxAxis2);
		 gscatter2.append("g")
		 	.attr("class", "scyAxis")
		 	.call(scatteryAxis2);


		// Creating grid lines
		var numTicks2 = 10

		var yAxisGrid = scatteryAxis2.ticks(numTicks2)
			.tickSize(scatterWidth2, 0)
			.tickFormat("")
			.orient("right");
		var xAxisGrid = scatterxAxis2.ticks(numTicks2)
			.tickSize(-scatterHeight2, 0)
			.tickFormat("")
			.orient("top");
		gscatter2.append("g")
			.attr("class", "grid")
			.call(yAxisGrid)
		gscatter2.append("g")
			.attr("class", "grid")
			.call(xAxisGrid)

		// Generate line of best fit
		// Filling points array
		var bestfit2 = [],
			a = .0056,
			b = -.062;
		for (var k = 5; k < 18; k++) {
			bestfit2.push( {x: k, y: a * Math.pow(Math.E, b*k)});
		};

		// Create line
		var line = d3.svg.line()
			.x(function(d) {
				return scatterxScale2(d.x);})
			.y(function(d) {return scatteryScale2(d.y);})
		gscatter2.append("path")
      		.datum(bestfit2)
      		.attr("class", "line")
      		.attr("d", line);


		// Drawing dots 
		gscatter2.append("g")
			.selectAll(".dot")
			.data(rows)
			 .enter().append("circle")
			 .attr("class", "dot")
			 .attr("cx", scatterxMap2)
			 .attr("cy", scatteryMap2)
			 .attr("r", 5)
			.style("fill", function(d) {
				return percentScale(d.Percent);
			})
			// .attr("stroke", "#d3d3d3")
			// .attr("stroke-width", ".5");

		// Appending state abbreviations
		gscatter2.append("g")
			.selectAll("text")
			.data(rows)
			.enter()
			.append("text")
			.text(function(d) {
				return d.Tag;
			})
			.attr("x", function(d) {
				return scatterxMap2(d) - 5;
			})
			.attr("y", function(d) {
				return scatteryMap2(d) + 3;
			})
			.attr("font-size", "8px")
});


</script>
</body>
</html>
